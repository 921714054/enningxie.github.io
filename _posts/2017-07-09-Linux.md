---
layout: post
title: Linux
date: 2017-07-09
categories: blog
tags: [Linux]
description: Linux升级之路
---

## 1. 从添加用户开始谈起

Linux中添加一个新的用户，可以使用`adduser`或`useradd`命令。

在Ubuntu中`adduser`是一个脚本，而`useradd`是一个二进制程序，前者对后者进行了封装，更加智能。

但在CentOS中`adduser`和`useradd`完全相同，前者只是一个符号连接。

注意的是，`useradd`在任何Linux发行版都是一样的，所以我们最好牢记它。

添加一个新用户最简单的方法：  
`# useradd enningxie`（注意需要root权限）

上述命令执行后，系统为我们创建了一个新的用户，用户名为“enningxie”。系统在创建过程中帮我们设置好了很多的默认值，包括：创建一个唯一的UID；添加一个与用户名相同的用户组和一个唯一的GID，并将用户设置为该组；在/home目录下创建一个与用户名同名的目录；设置shell为/bin/bash。唯一还没有设置的就是密码了，使用`passwd`命令可以做到这点。

**拓展部分**：

> `usermod`用于修正某些细微的配置参数，比如希望使用一个不同的shell；  
`userdel`用于删除某个用户，`-r`参数选项，把用户的home目录一同删除；  
用户组的管理同用户的管理类似，相似的命令有：`groupadd`、`groupmod`、`groupdel`、`gpasswd`。

## 2. 关于sudo的用法

Linux的用户除了root就是普通用户，而普通用户的权限非常低，就连向系统安装软件的权利都没有。很多时候系统管理员为了能让普通用户具备一点root用户的特权，就可以赋给用户被称为sudo的特权。

给某个用户赋予sudo特权，实际上就是更改/etc/sudoers文件中的内容。在该文件中有一行：  
`root ALL=(ALL) ALL`  
它的含义是说root用户可以使用sudo特权以root权限执行任何命令。

现在，我们想要为一个用户赋予sudo特权，我们可以参照上述写法：  
`enningxie ALL=(ALL) ALL`  

赋予一个用户组的所有用户sudo特权：  
`%groupname ALL=(ALL) ALL`

特殊写法：  
`%groupname ALL=(ALL) NOPASSWD:ALL`  
关键字NOPASSWD，可以使得不需要输入密码即可拥有root权限。这个NOPASSWD并不仅仅作用于用户组，对于我们之前所说的单个用户授权的方法也是有效的。但是这种写法会导致权限过大，（不输密码感觉有点不负责任的样子），所以不建议使用。

`%users ALL=/sbin/mount /mnt/cdrom, /sbin/unmount /mnt/cdrom`  
这一行主要描述了users用户组，可以执行：  
`sudo mount /mnt/cdrom`  
`sudo unmount /mnt/cdrom`  
除了这两条命令之外，其它的都会被Linux系统拒绝。

`%users ALL=(ALL) ALL,!/usr/sbin/adduser,!/usr/sbin/useradd`  
这一行使得users用户组无法使用sudo特权给系统添加新的用户。

新建用户之后，会涉及到用户之间的切换问题；用户间切换使用`su`命令。  
`su`命令就是做临时用户切换的，默认是切换到root用户。`su`在做用户切换的时候也会提示输入密码，但是与`sudo`需要输入自己的密码不同，`su`要求的是输入目标用户密码，退出切换后的用户用`exit`。  
如果不给`su`任何参数，那么它默认切换的是root用户，同时不会更改当前所在的目录。加上`-`参数后，即`su -`，则会改变当前目录到目标用户的home目录。例如：`su enningxie -`，就会立即切换到enningxie用户下，同时当前目录变更为/home/enningxie。  
使用`su`命令，管理员可以任意切换成任何用户，这是给管理员在管理上带来的很大的便利。然而普通用户的隐私，在管理员面前也就完全公开了。  
有意思的是，对于被赋予sudo特权的普通用户来说可以通过执行`sudo su -`跳过root密码，反之用自己的密码进入root用户（tips）。避免这种问题的发生，应该在/etc/sudoers文件中明确禁止`su`被`sudo`特权执行。
